import streamlit as st
import matplotlib.pyplot as plt
import numpy as np

st.set_page_config(page_title="ì„œì¹´ë””ì•ˆ ë¦¬ë“¬ê³¼ ìˆ˜ë©´", layout="wide")

st.title("ğŸ•’ ì„œì¹´ë””ì•ˆ ë¦¬ë“¬ê³¼ ìˆ˜ë©´")
st.markdown("---")

# 1. ì„œì¹´ë””ì•ˆ ë¦¬ë“¬ ì„¤ëª…
st.header("ğŸŒ ì„œì¹´ë””ì•ˆ ë¦¬ë“¬ì´ë€?")
st.markdown("""
**ì„œì¹´ë””ì•ˆ ë¦¬ë“¬(circadian rhythm)** ì€ ì•½ 24ì‹œê°„ ì£¼ê¸°ë¡œ ë°˜ë³µë˜ëŠ” ìƒë¬¼í•™ì  ë¦¬ë“¬ì…ë‹ˆë‹¤.
- ìˆ˜ë©´, ì²´ì˜¨, í˜¸ë¥´ëª¬, ì†Œí™” ë“± ìƒì²´ ê¸°ëŠ¥ ì¡°ì ˆ
- **ì‹œêµì°¨ìƒí•µ(SCN)** ê³¼ **ë©œë¼í† ë‹Œ**ì´ ì£¼ìš” ì¡°ì ˆì
- ë¹› ìê·¹ì— ì˜í•´ ë™ê¸°í™”ë¨
""")

# 2. ìˆ˜ë©´ê³¼ ì„œì¹´ë””ì•ˆ ë¦¬ë“¬
st.header("ğŸ˜´ ìˆ˜ë©´ê³¼ ì„œì¹´ë””ì•ˆ ë¦¬ë“¬ì˜ ê´€ê³„")
st.markdown("""
ìˆ˜ë©´ì€ ë‹¤ìŒ ë‘ ì‹œìŠ¤í…œì´ ì¡°ì ˆí•©ë‹ˆë‹¤:
- **ì„œì¹´ë””ì•ˆ ë¦¬ë“¬**: ìˆ˜ë©´ ì‹œì  ì¡°ì ˆ (ì–¸ì œ ìì•¼ í•˜ëŠ”ê°€)
- **ìˆ˜ë©´ í•­ìƒì„±**: ìˆ˜ë©´ ì••ë ¥ ì¡°ì ˆ (ì–¼ë§ˆë‚˜ ì¡¸ë¦°ê°€)

ë°¤ì—ëŠ” ë©œë¼í† ë‹Œì´ ë¶„ë¹„ë˜ê³ , ì•„ì¹¨ í–‡ë¹›ì€ ë©œë¼í† ë‹Œì„ ì–µì œí•´ ê°ì„±ì„ ìœ ë„í•©ë‹ˆë‹¤.
""")

# 3. ë¦¬ë“¬ ë¶•ê´´ ë¬¸ì œ
st.header("âš ï¸ ë¦¬ë“¬ì´ ê¹¨ì§ˆ ë•Œ ë°œìƒí•˜ëŠ” ë¬¸ì œ")
st.markdown("""
| ì›ì¸ | ë¬¸ì œ |
|------|------|
| ì•¼ê°„ ê·¼ë¬´ | ìˆ˜ë©´ì˜ ì§ˆ ì €í•˜, í”¼ë¡œ ëˆ„ì  |
| ë°¤ìƒ˜ ì‘ì—… | ìƒì²´ ë¦¬ë“¬ ë¶•ê´´, ì§‘ì¤‘ë ¥ ì €í•˜ |
| ë¸”ë£¨ë¼ì´íŠ¸ ë…¸ì¶œ | ë©œë¼í† ë‹Œ ì–µì œ â†’ ìˆ˜ë©´ ì§€ì—° |
""")

# 4. ìˆ˜ë©´ ê°œì„  íŒ
st.header("âœ… ê±´ê°•í•œ ìˆ˜ë©´ì„ ìœ„í•œ íŒ")
st.markdown("""
- ì¼ì •í•œ ìˆ˜ë©´/ê¸°ìƒ ì‹œê°„ ìœ ì§€
- ì•„ì¹¨ í–‡ë¹› ì¬ê¸°
- ìê¸° ì „ ì¡°ëª… ì¤„ì´ê¸°
- ìŠ¤ë§ˆíŠ¸í° ìì œ
- ê·œì¹™ì ì¸ ì‹ì‚¬, ìš´ë™
""")

# 5. ê°„ë‹¨í•œ ì„œì¹´ë””ì•ˆ ì„¤ë¬¸
st.header("ğŸ“ ë‚˜ì˜ ì„œì¹´ë””ì•ˆ ë¦¬ë“¬ ì²´í¬")

score = 0

q1 = st.radio("1. ì–¸ì œ ê°€ì¥ í™œë ¥ì´ ëŠê»´ì§€ë‚˜ìš”?", ["ì•„ì¹¨", "ì˜¤í›„", "ì €ë…"])
if q1 == "ì•„ì¹¨": score += 2
elif q1 == "ì˜¤í›„": score += 1

q2 = st.radio("2. ì£¼ë§ì— ìì—°ìŠ¤ëŸ½ê²Œ ì¼ì–´ë‚˜ëŠ” ì‹œê°„ì€?", ["6~8ì‹œ", "8~10ì‹œ", "10ì‹œ ì´í›„"])
if q2 == "6~8ì‹œ": score += 2
elif q2 == "8~10ì‹œ": score += 1

q3 = st.radio("3. ë°¤ 11ì‹œì¯¤ì´ë©´?", ["ì´ë¯¸ ì¡¸ë¦¬ë‹¤", "ì¡°ê¸ˆ í”¼ê³¤í•˜ë‹¤", "ì •ì‹ ì´ ë§‘ë‹¤"])
if q3 == "ì´ë¯¸ ì¡¸ë¦¬ë‹¤": score += 2
elif q3 == "ì¡°ê¸ˆ í”¼ê³¤í•˜ë‹¤": score += 1

q4 = st.radio("4. ì•„ì¹¨ì— ì¼ì–´ë‚˜ìë§ˆì?", ["ê¸ˆë°© í™œë™ ê°€ëŠ¥", "ì¡°ê¸ˆ í˜ë“¦", "ì •ë§ í˜ë“¦"])
if q4 == "ê¸ˆë°© í™œë™ ê°€ëŠ¥": score += 2
elif q4 == "ì¡°ê¸ˆ í˜ë“¦": score += 1

if st.button("ğŸ“Š ê²°ê³¼ ë³´ê¸°"):
    st.markdown("### ğŸ” ê²°ê³¼:")
    if score >= 7:
        st.success("ë‹¹ì‹ ì€ **ì•„ì¹¨í˜• ì¸ê°„(early chronotype)** ì´ì—ìš”!")
    elif score >= 4:
        st.info("ë‹¹ì‹ ì€ **ì¤‘ê°„í˜•(mid-type)** ì´ì—ìš”.")
    else:
        st.warning("ë‹¹ì‹ ì€ **ì €ë…í˜• ì¸ê°„(late chronotype)** ì´ì—ìš”!")

# 6. ê·¸ë˜í”„ ì‹œê°í™”
st.header("ğŸ“ˆ ì„œì¹´ë””ì•ˆ ë¦¬ë“¬ ë¶„ì„ ì˜ˆì‹œ ê·¸ë˜í”„")

time = np.linspace(0, 24, 100)

# ì˜ˆì‹œ ë¦¬ë“¬ curves (ì •ê·œí™”ëœ ê³¡ì„ )
melatonin = np.maximum(0, np.sin((time - 21) / 24 * 2 * np.pi))  # ë°¤ì— ìƒìŠ¹
alertness = np.maximum(0, np.sin((time - 10) / 24 * 2 * np.pi))  # ë‚®ì— ìƒìŠ¹
body_temp = 0.5 + 0.5 * np.sin((time - 17) / 24 * 2 * np.pi)     # ì˜¤í›„ì— ìµœê³ ì¡°
sleep_drive = 1 - alertness                                       # ì¡¸ë¦¼ì€ ë°˜ë¹„ë¡€

fig, ax = plt.subplots(figsize=(10, 5))
ax.plot(time, melatonin, label="ë©œë¼í† ë‹Œ", color="blue")
ax.plot(time, alertness, label="ì§‘ì¤‘ë ¥(ê°ì„±)", color="orange")
ax.plot(time, body_temp, label="ì²´ì˜¨", color="green")
ax.plot(time, sleep_drive, label="ì¡¸ë¦¼ (ìˆ˜ë©´ ì••ë ¥)", color="purple")

ax.set_xticks(np.arange(0, 25, 3))
ax.set_xlabel("ì‹œê°„ (ì‹œ)")
ax.set_ylabel("í™œì„±ë„ (ìƒëŒ€)")
ax.set_title("ì„œì¹´ë””ì•ˆ ë¦¬ë“¬ì˜ ìƒë¦¬ì  ë³€í™” (ì˜ˆì‹œ)")
ax.legend()
ax.grid(True)

st.pyplot(fig)

# 7. ì¶”ê°€ ì •ë³´
with st.expander("ğŸ“š ì²­ì†Œë…„ê³¼ ë…¸ì¸ì˜ ë¦¬ë“¬ ë³€í™”"):
    st.markdown("""
    - ì²­ì†Œë…„: ë©œë¼í† ë‹Œ ë¶„ë¹„ê°€ ëŠ¦ì–´ì ¸ **ë°¤í˜• ì¸ê°„**ì´ ë˜ê¸° ì‰¬ì›€  
    - ë…¸ì¸: ë©œë¼í† ë‹Œ ë¶„ë¹„ ê°ì†Œ â†’ **ì§§ê³  ì–•ì€ ìˆ˜ë©´**
    """)

st.markdown("---")
st.caption("â“’ 2025 ê±´ê°•í•œ ìƒí™œ ë¦¬ë“¬ í”„ë¡œì íŠ¸")
