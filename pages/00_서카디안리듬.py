import streamlit as st
import numpy as np
import plotly.graph_objects as go

st.set_page_config(page_title="ì„œì¹´ë””ì•ˆ ë¦¬ë“¬ê³¼ ìˆ˜ë©´", layout="wide")

st.title("ğŸ•’ ì„œì¹´ë””ì•ˆ ë¦¬ë“¬ê³¼ ìˆ˜ë©´")
st.markdown("---")

# 1. ì„œì¹´ë””ì•ˆ ë¦¬ë“¬ì´ë€?
st.header("ğŸŒ ì„œì¹´ë””ì•ˆ ë¦¬ë“¬ì´ë€?")
st.markdown("""
**ì„œì¹´ë””ì•ˆ ë¦¬ë“¬(circadian rhythm)** ì€ ì•½ 24ì‹œê°„ ì£¼ê¸°ë¡œ ë°˜ë³µë˜ëŠ” ìƒë¬¼í•™ì  ë¦¬ë“¬ìœ¼ë¡œ,  
ìˆ˜ë©´, ì²´ì˜¨, í˜¸ë¥´ëª¬ ë¶„ë¹„, ì†Œí™” ë“± ë‹¤ì–‘í•œ ìƒì²´ ê¸°ëŠ¥ì„ ì¡°ì ˆí•©ë‹ˆë‹¤.

- ë‡Œ ì† **ì‹œêµì°¨ìƒí•µ(SCN)** ì´ ì¤‘ì‹¬ ì¡°ì ˆ ì—­í• 
- **ë¹›(ìì—°ê´‘)** ì— ì˜í•´ ë¦¬ë“¬ ì¡°ì ˆ
- **ë©œë¼í† ë‹Œ** ë¶„ë¹„ë¥¼ í†µí•´ ìˆ˜ë©´ ìœ ë„
""")

# 2. ìˆ˜ë©´ê³¼ì˜ ê´€ê³„
st.header("ğŸ˜´ ìˆ˜ë©´ê³¼ ì„œì¹´ë””ì•ˆ ë¦¬ë“¬ì˜ ê´€ê³„")
st.markdown("""
ìˆ˜ë©´ì€ ë‘ ê°€ì§€ ì‹œìŠ¤í…œì— ì˜í•´ ì¡°ì ˆë©ë‹ˆë‹¤:

| ì‹œìŠ¤í…œ | ì„¤ëª… |
|--------|------|
| **ì„œì¹´ë””ì•ˆ ë¦¬ë“¬** | ì–¸ì œ ìê³  ì¼ì–´ë‚ ì§€ë¥¼ ì¡°ì ˆ |
| **ìˆ˜ë©´ í•­ìƒì„±** | ì–¼ë§ˆë‚˜ ì˜¤ë˜ ê¹¨ì–´ ìˆì—ˆëŠ”ì§€ì— ë”°ë¼ ìˆ˜ë©´ ìš•êµ¬ ì¦ê°€ |

---

- ë°¤ì´ ë˜ë©´ **ë©œë¼í† ë‹Œ**ì´ ë¶„ë¹„ë˜ì–´ ì¡¸ìŒ ìœ ë„
- ì•„ì¹¨ í–‡ë¹›ì€ ë©œë¼í† ë‹Œ ë¶„ë¹„ë¥¼ ì–µì œí•˜ê³  **ê°ì„± ìœ ë„**
""")

# 3. ë¦¬ë“¬ì´ ê¹¨ì¡Œì„ ë•Œ
st.header("âš ï¸ ì„œì¹´ë””ì•ˆ ë¦¬ë“¬ì´ ê¹¨ì§ˆ ë•Œ ìƒê¸°ëŠ” ë¬¸ì œ")
st.markdown("""
| ì›ì¸ | ê²°ê³¼ |
|------|------|
| ì•¼ê°„ ê·¼ë¬´ | í”¼ë¡œ ëˆ„ì , ìˆ˜ë©´ ì§ˆ ì €í•˜ |
| ë°¤ìƒ˜ í™œë™ | ì§‘ì¤‘ë ¥ ì €í•˜, ìš°ìš¸ê° ì¦ê°€ |
| ìŠ¤ë§ˆíŠ¸í° ê³¼ë‹¤ ì‚¬ìš© | ë©œë¼í† ë‹Œ ì–µì œ â†’ ìˆ˜ë©´ ì§€ì—° |
| ì‹œì°¨ ì ì‘ ì‹¤íŒ¨ | ë‚®ì— ì¡¸ë¦¬ê³  ë°¤ì— ê°ì„± |

ì´ëŸ° ìƒíƒœê°€ ì§€ì†ë˜ë©´ **ë¶ˆë©´ì¦, ìš°ìš¸ì¦, ë¹„ë§Œ, ë‹¹ë‡¨** ë“±ì˜ ê±´ê°• ë¬¸ì œë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
""")

# 4. ê±´ê°•í•œ ìˆ˜ë©´ì„ ìœ„í•œ íŒ
st.header("âœ… ê±´ê°•í•œ ìˆ˜ë©´ê³¼ ë¦¬ë“¬ ìœ ì§€ë¥¼ ìœ„í•œ íŒ")
st.markdown("""
- ğŸ•°ï¸ **ì¼ì •í•œ ìˆ˜ë©´ ì‹œê°„ ìœ ì§€** (ì£¼ë§ í¬í•¨)
- â˜€ï¸ **ì•„ì¹¨ í–‡ë¹› ì¬ê¸°**: ë©œë¼í† ë‹Œ ì–µì œ, ë¦¬ë“¬ ì¡°ì ˆ
- ğŸ’¡ **ë°¤ì—” ì¡°ëª… ë‚®ì¶”ê¸°**: ìˆ˜ë©´ ìœ ë„
- ğŸ“µ **ìê¸° ì „ ìŠ¤ë§ˆíŠ¸í° ê¸ˆì§€**
- ğŸ½ï¸ **ê·œì¹™ì ì¸ ì‹ì‚¬ì™€ ìš´ë™**

ê¾¸ì¤€í•œ ìŠµê´€ì´ **ë¦¬ë“¬ íšŒë³µì˜ í•µì‹¬**ì…ë‹ˆë‹¤.
""")

# 5. ì„¤ë¬¸: ì„œì¹´ë””ì•ˆ ë¦¬ë“¬ ìœ í˜• ì²´í¬
st.header("ğŸ“ ë‚˜ì˜ ì„œì¹´ë””ì•ˆ ë¦¬ë“¬ ì²´í¬")
st.markdown("ë‹¤ìŒ ê°„ë‹¨í•œ ë¬¸í•­ì— ë‹µí•´ ë³´ì„¸ìš”. ë‹¹ì‹ ì€ ì•„ì¹¨í˜• ì¸ê°„ì¼ê¹Œìš”? ì €ë…í˜• ì¸ê°„ì¼ê¹Œìš”?")

score = 0

q1 = st.radio("1. ì–¸ì œ ê°€ì¥ í™œë ¥ì´ ëŠê»´ì§€ë‚˜ìš”?", ["ì•„ì¹¨", "ì˜¤í›„", "ì €ë…"])
if q1 == "ì•„ì¹¨": score += 2
elif q1 == "ì˜¤í›„": score += 1

q2 = st.radio("2. ì£¼ë§ì— ìì—°ìŠ¤ëŸ½ê²Œ ì¼ì–´ë‚˜ëŠ” ì‹œê°„ì€?", ["6~8ì‹œ", "8~10ì‹œ", "10ì‹œ ì´í›„"])
if q2 == "6~8ì‹œ": score += 2
elif q2 == "8~10ì‹œ": score += 1

q3 = st.radio("3. ë°¤ 11ì‹œì¯¤ì´ë©´?", ["ì´ë¯¸ ì¡¸ë¦¬ë‹¤", "ì¡°ê¸ˆ í”¼ê³¤í•˜ë‹¤", "ì •ì‹ ì´ ë§‘ë‹¤"])
if q3 == "ì´ë¯¸ ì¡¸ë¦¬ë‹¤": score += 2
elif q3 == "ì¡°ê¸ˆ í”¼ê³¤í•˜ë‹¤": score += 1

q4 = st.radio("4. ì•„ì¹¨ì— ì¼ì–´ë‚˜ìë§ˆì?", ["ê¸ˆë°© í™œë™ ê°€ëŠ¥", "ì¡°ê¸ˆ í˜ë“¦", "ì •ë§ í˜ë“¦"])
if q4 == "ê¸ˆë°© í™œë™ ê°€ëŠ¥": score += 2
elif q4 == "ì¡°ê¸ˆ í˜ë“¦": score += 1

if st.button("ğŸ“Š ê²°ê³¼ ë³´ê¸°"):
    st.markdown("### ğŸ” ê²°ê³¼:")
    if score >= 7:
        st.success("ë‹¹ì‹ ì€ **ì•„ì¹¨í˜• ì¸ê°„(early chronotype)** ì´ì—ìš”! ì•„ì¹¨ì— ì§‘ì¤‘ë ¥ì´ ì¢‹ê³ , ë°¤ì—” ì¼ì° ì¡¸ë ¤ìš”.")
    elif score >= 4:
        st.info("ë‹¹ì‹ ì€ **ì¤‘ê°„í˜•(mid-type)** ì´ì—ìš”. ì¼ë°˜ì ì¸ ìˆ˜ë©´/í™œë™ íŒ¨í„´ì„ ê°€ì§€ê³  ìˆì–´ìš”.")
    else:
        st.warning("ë‹¹ì‹ ì€ **ì €ë…í˜• ì¸ê°„(late chronotype)** ì´ì—ìš”! ë°¤ì— ë” í™œë°œí•˜ì§€ë§Œ ì•„ì¹¨ì—” ëŠë¦´ ìˆ˜ ìˆì–´ìš”.")

# 6. Plotly ê·¸ë˜í”„ ì‹œê°í™”
st.header("ğŸ“ˆ ì„œì¹´ë””ì•ˆ ë¦¬ë“¬ ë¶„ì„ ì˜ˆì‹œ ê·¸ë˜í”„ (Plotly)")

time = np.linspace(0, 24, 100)

melatonin = np.maximum(0, np.sin((time - 21) / 24 * 2 * np.pi))  # ë°¤ì— ìƒìŠ¹
alertness = np.maximum(0, np.sin((time - 10) / 24 * 2 * np.pi))  # ë‚®ì— ìƒìŠ¹
body_temp = 0.5 + 0.5 * np.sin((time - 17) / 24 * 2 * np.pi)     # ì˜¤í›„ì— ìµœê³ ì¡°
sleep_drive = 1 - alertness                                       # ì¡¸ë¦¼ì€ ë°˜ë¹„ë¡€

fig = go.Figure()

fig.add_trace(go.Scatter(x=time, y=melatonin, mode='lines', name='ë©œë¼í† ë‹Œ', line=dict(color='blue')))
fig.add_trace(go.Scatter(x=time, y=alertness, mode='lines', name='ì§‘ì¤‘ë ¥(ê°ì„±)', line=dict(color='orange')))
fig.add_trace(go.Scatter(x=time, y=body_temp, mode='lines', name='ì²´ì˜¨', line=dict(color='green')))
fig.add_trace(go.Scatter(x=time, y=sleep_drive, mode='lines', name='ì¡¸ë¦¼(ìˆ˜ë©´ ì••ë ¥)', line=dict(color='purple')))

fig.update_layout(
    title="ì„œì¹´ë””ì•ˆ ë¦¬ë“¬ì˜ ìƒë¦¬ì  ë³€í™” (ì˜ˆì‹œ)",
    xaxis_title="ì‹œê°„ (ì‹œ)",
    yaxis_title="í™œì„±ë„ (ìƒëŒ€ ìˆ˜ì¹˜)",
    xaxis=dict(tickmode='array', tickvals=list(range(0, 25, 3))),
    template="plotly_white",
    legend=dict(orientation="h", yanchor="bottom", y=-0.3, xanchor="center", x=0.5),
    margin=dict(t=60, b=60)
)

st.plotly_chart(fig, use_container_width=True)

# 7. ì¶”ê°€ ì •ë³´
with st.expander("ğŸ“š ì¶”ê°€ ì •ë³´: ì²­ì†Œë…„ê³¼ ë…¸ì¸ì˜ ìˆ˜ë©´ ì°¨ì´"):
    st.markdown("""
    - **ì²­ì†Œë…„ê¸°**ì—ëŠ” ë©œë¼í† ë‹Œ ë¶„ë¹„ ì‹œê°„ì´ ëŠ¦ì¶°ì ¸ ë°¤ì— ëŠ¦ê²Œ ìê³  ëŠ¦ê²Œ ì¼ì–´ë‚˜ëŠ” ê²½í–¥ì´ ìˆì–´ìš”.
    - **ë…¸ë…„ê¸°**ì—ëŠ” ë©œë¼í† ë‹Œ ë¶„ë¹„ëŸ‰ì´ ê°ì†Œí•´ **ì§§ê³  ì–•ì€ ìˆ˜ë©´**ì„ ê²ªëŠ” ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤.
    """)

st.markdown("---")
st.caption("â“’ 2025 ê±´ê°•í•œ ìƒí™œ ë¦¬ë“¬ í”„ë¡œì íŠ¸")
